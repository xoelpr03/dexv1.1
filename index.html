<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Ultimate Dex</title>
    <style>
    :root { 
        --scarlet: #ff2424; 
        --violet: #8c47ff; 
        --accent: #3c5aa6;
        --silver-light: #f8fafc;
        --silver-mid: #e2e8f0;
        --silver-dark: #94a3b8;
        --accent: #3b82f6; 
        --accent-glow: rgba(59, 130, 246, 0.5);
    }

    body { 
        font-family: 'Inter', sans-serif; 
        margin: 0; padding: 0; 
        color: #1e293b;  
        transition: background 0.5s ease; /* Makes the color swap smooth */
        height: 100%;
    }

   #display-card {
    background: rgba(255, 255, 255, 0.9); /* Semi-transparent white */
    backdrop-filter: blur(10px); /* Blurs the background behind the card */
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

    .container { max-width: 1100px; margin: auto; padding: 10px; box-sizing: border-box; }

    /* --- MAIN MENU / SEARCH SECTION --- */
    #search-section { 
        display: flex; 
        flex-direction: column; 
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
        width: 100%;
        transition: all 0.3s ease;
        overflow: hidden; /* desactiva scroll */
        height: 100vh;
    }

    .search-box-container { 
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        padding: 30px 20px; 
        border-radius: 30px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
        text-align: center; 
        width: 90%; 
        max-width: 600px; 
    }

    .dex-title { 
        margin: 0 0 20px 0; 
        background: linear-gradient(69deg, #568053, #f0c000); 
        -webkit-background-clip: text; 
        -webkit-text-fill-color: transparent; 
        font-size: clamp(24px, 8vw, 38px); 
        font-weight: 900; 
        cursor: pointer; 
    }

    #goBtn {
    background-color: var(--accent) !important;
    transition: background 0.3s ease, box-shadow 0.3s ease;
}
.stat-bar-fill {
    /* background removed to allow dynamic coloring */
    box-shadow: 0 0 12px var(--accent-glow);
    transition: width 0.5s ease;
}

    .main-nav { display: flex; flex-direction: column; gap: 10px; width: 100%; }

    .search-wrapper { 
        position: relative; 
        width: 100%; 
        display: flex; 
        flex-direction: row; /* Horizontal layout restored */
        gap: 10px; 
        align-items: stretch;
    }

    .nav-input { 
        flex-grow: 1; 
        padding: 15px 20px; 
        border: 3px solid #e2e8f0; 
        border-radius: 18px; 
        outline: none; 
        font-size: 16px; 
        background: white;
    }

    .search-btn { 
        background: var(--accent); 
        color: white; 
        border: none; 
        border-radius: 18px; 
        padding: 0 25px; 
        font-weight: 800; 
        cursor: pointer; 
        transition: transform 0.1s;
    }
    
    .search-btn:active { transform: scale(0.95); }

    /* --- SUGGESTIONS --- */
    .suggestions { 
        position: absolute; 
        top: 100%; left: 0; right: 0; 
        background: white; 
        border-radius: 12px; 
        z-index: 1000; 
        box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
        display: none; 
        overflow-y: auto; 
        max-height: 250px; 
        margin-top: 5px;
    }
    .list-item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
    .list-item:hover, .list-item.selected { background-color: #e2e8f0; }

    /* --- DISPLAY CARD --- */
    #display-card { 
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 24px; 
        padding: 20px; 
        box-shadow: 0 20px 40px rgba(0,0,0,0.08); 
        border: 1px solid white;
        margin-top: 10px; 
        margin-bottom: 20px;
        display: none;
    }

    .header-flex { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 20px; 
        gap: 10px; 
        position: sticky; 
        top: 0; 
        background: rgba(255,255,255,0.9); 
        padding: 10px 0; 
        z-index: 10; 
    }

    .layout-grid { display: grid; grid-template-columns: 320px 1fr; gap: 20px; }

    /* --- VARIANTS & TOGGLES --- */
    #formsArea {
        background: rgba(255, 255, 255, 0.5) !important;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(226, 232, 240, 0.6) !important;
        padding: 20px;
        border-radius: 20px;
        margin-bottom: 20px;
    }

    #formsList { display: flex; flex-wrap: wrap; gap: 8px; }

    .form-btn {
    background: white;
    border: 2px solid #f1f5f9;
    border-radius: 12px;
    padding: 8px 14px;
    font-size: 11px;
    font-weight: 800;
    color: #64748b;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s ease;
    margin: 2px;
}

.form-btn:hover {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
}

.form-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
}

    .variant-btn {
        background: white;
        border: 2px solid #f1f5f9;
        border-radius: 12px;
        padding: 8px 14px;
        font-size: 11px;
        font-weight: 800;
        color: #64748b;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.2s;
    }

    .variant-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

    .v-toggle { font-size: 12px; padding: 10px 15px; border-radius: 20px; border: 2px solid #e2e8f0; background: white; font-weight: 900; }
    .v-toggle.active { background: var(--accent); color: white; border-color: var(--accent); }

    /* --- STATS & TYPES --- */
    .stat-row { display: flex; align-items: center; margin-bottom: 8px; font-size: 12px; font-weight: 900; }
    .stat-bar-bg { flex-grow: 1; background: #e2e8f0; height: 12px; border-radius: 6px; margin: 0 10px; overflow: hidden; }
    .stat-bar-fill { height: 100%; border-radius: 6px; transition: width 0.6s ease; }
    .type-badge { padding: 6px 12px; border-radius: 8px; color: white; font-size: 11px; font-weight: 800; text-transform: uppercase; margin: 4px; display: inline-block; }

    /* --- EVOLUTION CHAIN --- */
    #evoChain { display: flex; flex-direction: row; justify-content: center; align-items: center; width: 100%; overflow-x: auto; padding: 10px 0; }
    .evo-stage-col { display: flex; flex-direction: column; align-items: center; text-align: center; }
    .evo-img { width: 70px; height: 70px; }
/* --- STABLE EMOJI SHINY BUTTON --- */
.shiny-btn { 
    font-size: 32px; 
    background: none; 
    border: none; 
    cursor: pointer;
    padding: 10px;
    /* Removed rotate to prevent skewing */
    transition: transform 0.2s ease, filter 0.3s ease;
    filter: grayscale(1) opacity(0.4); 
    user-select: none;
    display: inline-flex; /* Changed to inline-flex for tighter centering */
    align-items: center;
    justify-content: center;
    line-height: 1; /* Prevents vertical shifting */
    vertical-align: middle;
    outline: none;
    -webkit-tap-highlight-color: transparent; /* Fixes blue box on mobile tap */
}

.shiny-btn:hover {
    /* Only scale, no rotation to keep it stable */
    transform: scale(1.1);
    filter: grayscale(0.5) opacity(0.8);
}

.shiny-btn:active {
    /* Shrink slightly when pressed to give a "physical button" feel */
    transform: scale(0.9);
}

.shiny-btn.active { 
    filter: grayscale(0) opacity(1) drop-shadow(0 0 10px #ffcb05);
    transform: scale(1.1);
}
.fav-btn {
    background: none;      /* Removes gray background */
    border: none;          /* Removes the border box */
    padding: 0;            /* Removes inner spacing */
    font-size: 24px;       /* Makes the heart the right size */
    cursor: pointer;       /* Changes cursor to hand on hover */
    outline: none;         /* Removes the blue ring when clicked */
    transition: transform 0.1s ease; /* Smooth pop effect */
}

.fav-btn:hover {
    transform: scale(1.2); /* Makes it pop slightly when you hover */
}

.fav-btn:active {
    transform: scale(0.9); /* Makes it "squish" when you click it */
}
/* Fix for the header container to prevent the emoji from jumping */
.header-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: 50px; /* Ensures the row height stays consistent */
}


/* Back button matching the clean silver look */
.back-btn { 
    background: transparent;
    border: 1px solid var(--silver-mid);
    padding: 8px 16px; 
    border-radius: 12px; 
    font-weight: 800; 
    color: var(--silver-dark); 
    cursor: pointer;
    text-transform: uppercase;
    font-size: 11px;
    letter-spacing: 1px;
    transition: all 0.2s;
}

.back-btn:hover {
    background: var(--silver-light);
    color: var(--accent);
    border-color: var(--accent);
}
    /* --- TABLES --- */
    table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 15px; }
    th { color: var(--silver-dark); text-transform: uppercase; letter-spacing: 1px; font-size: 10px; text-align: left; padding: 8px; }
    td { padding: 12px 8px; border-bottom: 1px solid #f1f5f9; text-transform: capitalize; }
    #movesBody td { font-variant: small-caps; font-size: 14px; }

    /* --- FOOTER CREDIT --- */
    .creator-credit {
        margin-top: 30px;
        font-size: 10px;
        font-weight: 800;
        text-transform: lowercase;
        letter-spacing: 2px;
        color: var(--silver-dark);
        opacity: 0.6;
        text-align: center;
        border-top: 1px solid var(--silver-light);
        padding-top: 15px;
        width: 200px;
        margin-left: auto;
        margin-right: auto;
    }

    /* --- MOBILE OPTIMIZATION --- */
    @media (max-width: 850px) {
        .layout-grid { grid-template-columns: 1fr; }
        .header-flex { flex-wrap: wrap; justify-content: center; }
        #pokeImg { width: 220px !important; margin: auto; }
        #favorites-gallery {
        gap: 5px; /* Tighter gap for small screens */
        padding: 8px;
        min-height: 55px;
        justify-content: flex-start; /* Better for scrolling lists */
        overflow-x: auto; /* Allow horizontal swiping if team is large */
        flex-wrap: nowrap; /* Keeps team in one row you can swipe */
    }

    #favorites-gallery img {
        width: 45px; /* Slightly smaller sprites */
        height: 45px;
    }

    /* 2. Search Bar Layout */
    .search-section {
        flex-direction: column;
        padding: 15px;
        width: 90%;
    }

    #pokeIn {
        font-size: 16px; /* Prevents iOS from zooming in on focus */
        padding: 12px;
    }

    /* 3. The Display Card */
    #display-card {
        margin: 0;
        border-radius: 0; /* Full width looks better on mobile */
        padding: 10px;
    }

    /* 4. Make Buttons Larger (Easier to tap with thumbs) */
    .fav-btn, .shiny-btn {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    }

    @media (max-width: 600px) {
        .search-box-container { width: 95%; padding: 20px 15px; }
        #pokeName { font-size: 26px !important; text-align: center; }
        .dex-title { font-size: 28px !important; }
        #formsList { display: grid; grid-template-columns: 1fr 1fr; }
        .variant-btn { text-align: center; padding: 12px 5px; }
        .search-wrapper { gap: 5px; }
        .search-btn { padding: 0 15px; }
    }
        /* --- MOVE CATEGORY ICONS RESTORED --- */
.cat-icon { 
    width: 12px; 
    height: 12px; 
    display: inline-block; 
    vertical-align: middle; 
    margin-right: 8px; 
}

/* Red Triangle for Physical Moves */
.cat-physical { 
    width: 0; 
    height: 0; 
    border-left: 6px solid transparent; 
    border-right: 6px solid transparent; 
    border-bottom: 11px solid #ef4444; 
}

/* Blue Circle for Special Moves */
.cat-special { 
    background-color: #3b82f6; 
    border-radius: 50%; 
    width: 11px; 
    height: 11px; 
}

/* Silver Ring for Status Moves */
.cat-status { 
    border: 2px solid #94a3b8; 
    border-radius: 50%; 
    width: 10px; 
    height: 10px; 
    box-sizing: border-box; 
                   }
        /* --- GLOBAL MOBILE OPTIMIZATION --- */
@media (max-width: 600px) {
    /* 1. Prevent Horizontal Overflow & Improve Scrolling */
    html, body {
        overflow-x: hidden; 
        position: relative;
        width: 100%;
    }

    .container {
        padding: 8px; /* Slimmer gutters for more content space */
    }

    /* 2. Search Section: Mobile Centering */
    #search-section {
        height: 80vh; /* Shorter height so keyboard doesn't hide everything */
    }

    .search-box-container {
        width: 92%;
        padding: 25px 15px;
        border-radius: 20px; /* Slightly tighter corners for small screens */
    }

    /* 3. Layout Grid: Single Column */
    .layout-grid {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    /* 4. Images & Identity */
    #pokeImg {
        width: 220px !important;
        height: auto;
        margin: 10px auto;
    }

    #pokeName {
        font-size: 28px !important;
        text-align: center;
    }

    /* 5. Touch-Friendly Targets */
    .variant-btn, .v-toggle, .back-btn {
        min-height: 44px; /* Apple/Android recommended tap size */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* 6. Evolution Chain: Horizontal Swipe */
   #evoChain {
    display: flex;
    gap: 3px;                  /* menos espacio entre Pok√©mon */
    justify-content: center;    /* centrado horizontal */
    align-items: center;        /* centrado vertical */
}

    /* 7. Move Table Optimization */
    .table-wrapper {
        margin: 0 -8px; /* Bleed to edges so it looks native */
        width: calc(100% + 16px);
        overflow-x: auto;
    }

    table {
        font-size: 13px; /* Slightly larger for legibility */
    }

    td, th {
        padding: 12px 8px; /* More vertical space for thumbs */
    }

    /* 8. Sticky Header Fix */
    .header-flex {
        position: sticky;
        top: 0;
        background: rgba(255, 255, 255, 0.98);
        padding: 10px;
        margin: -20px -20px 20px -20px; /* Pin to top of display card */
        border-radius: 24px 24px 0 0;
        border-bottom: 1px solid var(--silver-mid);
    }

    .mini-search-container {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-bottom: 20px;
}

#miniSearchInput {
    padding: 6px 12px;
    border-radius: 20px;
    border: 1px solid #e2e8f0;
    font-size: 12px;
    width: 140px;
    outline: none;
    background: rgba(255, 255, 255, 0.8);
    transition: border-color 0.2s;
}

#miniSearchInput:focus {
    border-color: var(--accent);
}

#miniSearchBtn {
    background: var(--accent);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 800;
    cursor: pointer;
    transition: opacity 0.2s;
}

#miniSearchBtn:hover {
    opacity: 0.8;
}

#pokeSuggsMini {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 12px;
    z-index: 1000;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    display: none;
    overflow-y: auto;
    max-height: 250px;
    margin-top: 5px;
}

#pokeSuggsMini .list-item {
    padding: 12px 15px;
    cursor: pointer;
    border-bottom: 1px solid #f1f5f9;
    font-size: 14px;
}

#pokeSuggsMini .list-item:hover, 
#pokeSuggsMini .list-item.selected {
    background-color: #e2e8f0;
}
}

/* Container for the entries */
.dex-container {
    background: #ffffff;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

/* The actual text styling */
#dexScarlet, #dexViolet, #dexPLA {
    font-size: 13px;
    line-height: 1.5;
    font-weight: 500;
    font-style: italic;
    display: flex;
    align-items: center; /* Centers text vertically against the circle */
}

/* Version circles styling */
.dex-circle {
    flex-shrink: 0; /* Prevents the circle from squishing if text is long */
    box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
}
        
        
    </style>
</head>
<body>
<div class="container"><div id="favorites-container" style="width: 100%; margin-bottom: 20px;">
    
    
    <div id="favorites-gallery" class="fav-gallery" style="
        display: flex; 
        gap: 10px; 
        flex-wrap: wrap; 
        justify-content: center; 
        align-items: center; 
        background: #f8fafc; 
        border: 2px solid #f1f5f9; 
        border-radius: 16px; 
        padding: 10px; 
        min-height: 70px;
        transition: all 0.3s ease;">
        <span style="color:#94a3b8; font-size: 11px;">Search for a Pok√©mon and click ü§ç to start your team!</span>
    </div>
</div>
    <div id="search-section">
        <div class="search-box-container">
            <h1 class="dex-title" onclick="location.reload()">Pok√©mon Ultimate Dex</h1>
            <div class="main-nav">
                <div class="search-wrapper">
                    <input type="text" id="pokeIn" class="nav-input" placeholder="Name or ID..." autocomplete="off">
                    <button class="search-btn" id="goBtn">GO</button>
<button id="randomBtn" onclick="loadRandomPokemon()" 
        style="
            font-size: 18px;         /* tama√±o del emoji */
            padding: 5px 10px;       /* compacto */
            border-radius: 12px;     /* redondeado como otros botones */
            border: none; 
            background: #f8fafc; 
            cursor: pointer;
            transition: transform 0.1s;
        " 
        onmouseover="this.style.transform='scale(1.2)'" 
        onmouseout="this.style.transform='scale(1)'">
        üé≤
    </button>                    <div id="pokeSuggs" class="suggestions"></div>  <!-- Contenedor para sugerencias -->
                </div>
            </div>
            <div class="creator-credit">created by ŒæawsjŒ±ke</div>
        </div>
        <div style="
    background: #f1f5f9; 
    border: 2px solid #e2e8f0; 
    border-radius: 20px; 
    padding: 20px; 
    margin-top: 20px; 
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
">
    <h3 style="
        margin: 0 0 15px 0; 
        font-family: sans-serif; 
        font-size: 14px; 
        font-weight: 900; 
        color: #64748b; 
        text-transform: uppercase; 
        letter-spacing: 1.5px; 
        text-align: center;
    ">
        üéÆ Mini-Games
    </h3>

    <div style="display: flex; flex-direction: column; gap: 10px;">
        <a href="https://xoelpr03.github.io/pokejuegoloremaster/" 
           style="display: block; 
                  text-align: center; 
                  padding: 14px; 
                  background-color: #10b981; 
                  color: white; 
                  text-decoration: none; 
                  border-radius: 12px; 
                  font-weight: bold; 
                  font-family: sans-serif;
                  transition: all 0.2s ease;
                  box-shadow: 0 4px 0px #059669;"
           onmouseover="this.style.backgroundColor='#059669'; this.style.transform='translateY(-1px)'"
           onmouseout="this.style.backgroundColor='#10b981'; this.style.transform='translateY(0)'">
            üèÜ LORE MASTER
        </a>

        <a href="https://xoelpr03.github.io/pokejuegobst/" 
           style="display: block; 
                  text-align: center; 
                  padding: 14px; 
                  background-color: #3b82f6; 
                  color: white; 
                  text-decoration: none; 
                  border-radius: 12px; 
                  font-weight: bold; 
                  font-family: sans-serif;
                  transition: all 0.2s ease;
                  box-shadow: 0 4px 0px #1d4ed8;"
           onmouseover="this.style.backgroundColor='#1d4ed8'; this.style.transform='translateY(-1px)'"
           onmouseout="this.style.backgroundColor='#3b82f6'; this.style.transform='translateY(0)'">
            üìä STAT MASTER
        </a>

        <a href="https://xoelpr03.github.io/pokejuegohigher/" 
           style="display: block; 
                  text-align: center; 
                  padding: 14px; 
                  background-color: #fcba03; 
                  color: white; 
                  text-decoration: none; 
                  border-radius: 12px; 
                  font-weight: bold; 
                  font-family: sans-serif;
                  transition: all 0.2s ease;
                  box-shadow: 0 4px 0px #b58c1b;"
           onmouseover="this.style.backgroundColor='#b58c1b'; this.style.transform='translateY(-1px)'"
           onmouseout="this.style.backgroundColor='#fcba03'; this.style.transform='translateY(0)'">
            ‚¨ÜÔ∏è HIGHER OR LOWER?
        </a>
    </div>
 </div>
</div>

    <div id="display-card" style="background: white; border-radius: 18px; padding: 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); max-width: 900px; margin: auto;">
    
    <!-- Search -->
    <div class="search-wrapper" style="margin-bottom: 15px; max-width: 300px;">
        <input type="text" id="miniSearchInput" class="nav-input" placeholder="Search Pok√©mon..." autocomplete="off">
        <button class="search-btn" id="miniSearchBtn" onclick="miniSearch()">GO</button>
<button id="randomBtn" onclick="loadRandomPokemon()" 
        style="
            font-size: 18px;         /* tama√±o del emoji */
            padding: 5px 10px;       /* compacto */
            border-radius: 12px;     /* redondeado como otros botones */
            border: none; 
            background: #f8fafc; 
            cursor: pointer;
            transition: transform 0.1s;
        " 
        onmouseover="this.style.transform='scale(1.2)'" 
        onmouseout="this.style.transform='scale(1)'">
        üé≤
    </button>        <div id="pokeSuggsMini" class="suggestions"></div>
    </div>
    <datalist id="pokeSuggestions"></datalist>

    <!-- Forms / Variants -->
    <div id="formsArea" style="padding: 15px; border-radius: 12px; margin-bottom: 20px; display: none; border: 1px solid #e2e8f0;">
        <span style="font-size:11px; font-weight:900; color:#94a3b8; display: block; margin-bottom: 12px; letter-spacing: 1px;">AVAILABLE VARIANTS</span>
        <div id="formsList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
    </div>

    <!-- Header Flex -->
    <div class="header-flex" style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 20px;">
        <button class="back-btn" onclick="goBack()">‚Üê BACK</button>
        <div class="game-switcher" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 0 auto; max-width: 90%;">
            <button id="btn-sv" 
                    class="game-btn active" 
                    style="background: linear-gradient(to right, var(--scarlet), var(--violet)); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('sv', this)">
                    SV
            </button>
            <button id="btn-la"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #ff9900, #ffcc00); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('la', this)">
                    PLA
            </button>
            <button id="btn-bdsp"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #46afcf, #cf46a3); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('bdsp', this)">
                    BDSP
            </button>
            <button id="btn-ss"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #009cfc, #fc0069); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('ss', this)">
                    SwSh
            </button>
            <button id="btn-lgpe"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #ffce08, #8a3200); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('lgpe', this)">
                    LGPE
            </button>
            <button id="btn-usum"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #ff9100, #0b008a); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('usum', this)">
                    USUM
            </button>
            <button id="btn-sm"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #ffbb00, #6a25c4); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('sm', this)">
                    SM
            </button>
            <button id="btn-oras"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #d90000, #0021db); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('oras', this)">
                    ORAS
            </button>
            <button id="btn-xy"
                    class="game-btn" 
                    style="background: linear-gradient(to right, #008bdb, #9c1717); 
                    border-radius: 50px; border: none; padding: 5px 10px; color: white; cursor: pointer; font-weight: bold;" 
                    onclick="setGame('xy', this)">
                    XY
            </button>
        </div>
        <button id="shinySparkle" class="shiny-btn" onclick="toggleShiny()">‚ú®</button>
        <button id="fav-btn" class="fav-btn" onclick="toggleFavorite()">ü§ç</button>
    </div>

    <!-- Main Content Grid -->
    <div class="layout-grid" style="display:flex; gap:20px; flex-wrap: wrap;">
        
        <!-- Left Column -->
<div style="flex:1; text-align: center; min-width: 250px;">
<h2 id="pokeName" style="margin: 0; font-size: 32px; text-transform: capitalize;"></h2>
            <div id="pCat" style="color: #64748b; font-weight: bold; font-size: 14px; margin-bottom: 15px;"></div>
    <div id="dexNumber" style="font-weight: 900; color: #94a3b8; font-size: 20px; margin-bottom:10px;">#0000</div>
    <img id="pokeImg" src="" style="width: 200px; max-width: 90%; height: auto; display:block; margin: auto;">

    <div id="nav-pokes" style="display:flex; justify-content: space-between; align-items: center; margin-top: 10px;"></div>
    <div id="pokeTypes" style="margin-top: 10px;"></div>
        <div id="role-container"style="margin-top: 20px; text-align: center; border-radius: 12px; padding: 15px; border: 1px solid #e2e8f0;"></div>
    <div id="stats-area" style="margin-top: 20px; text-align: left; border-radius: 12px; padding: 15px; border: 1px solid #e2e8f0;"></div>
    <div id="dexEntryBox" style="margin-top: 20px; padding: 16px; border-radius: 14px; border: 1px solid #e2e8f0; text-align: left; background: #fff;">
    <div style="font-weight: 900; font-size: 10px; color: #64748b; margin-bottom: 8px; letter-spacing: 1px; display: flex; justify-content: space-between; align-items: center;">
        <span>POKEDEX ENTRY</span>
        
    </div>

    <div id="dexEntryText" style="font-size: 14px; line-height: 1.5; color: #1e293b; font-style: italic;">
        ‚Äî
    </div>
</div>
<div id="pokeTypes"></div>
<div id="typeWeakness"></div>      <div id="pokeTypes"></div>          <div id="typeResistance"></div>    <div id="typeImmunity"></div></div>
        
        <!-- Right Column -->
        <div style="flex:1; min-width: 300px;">

<div id="abilitiesWrapper" style="
    background: #f8fafc;      
    border-radius: 12px;      
    border: 1px solid #e2e8f0; 
    padding: 15px;
    margin-top: 20px;
">
    <span style="
        font-size: 11px; 
        font-weight: 900; 
        color: #64748b; 
        display: block; 
        margin-bottom: 12px; 
        letter-spacing: 1px;
    ">ABILITIES</span>
    <div id="abilitiesArea" style="font-size: 14px; line-height: 1.4; margin-bottom: 0;">
        <!-- JS pondr√° aqu√≠ las habilidades -->
    </div>
</div>

            <!-- Evolution Chain -->
            <div id="evoChain" style="
    display: flex; 
    overflow-x: auto; 
    gap: 3px;           /* menos espacio entre Pok√©mon */
    margin-top: 10px; 
    align-items: center; 
    justify-content: center; /* centra la cadena */
    padding: 5px 0;     /* menos padding arriba/abajo */
    scrollbar-width: none;">
</div>
            
            <!-- Moves Table -->
            <div style="margin-top:25px;">
                <div style="display:flex; gap:8px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none;">
                    <button class="v-toggle" onclick="setMoveMode('level-up', this)">Level</button>
                    <button class="v-toggle" onclick="setMoveMode('machine', this)">TM</button>
                    <button class="v-toggle" onclick="setMoveMode('egg', this)">Egg</button>
                    <button class="v-toggle" onclick="setMoveMode('tutor', this)">Tutor</button>
                    <button class="v-toggle active" onclick="setMoveMode('all', this)">All</button>
                </div>
                <div style="overflow-x: auto; border-radius: 12px; border: 1px solid #e2e8f0; margin-top:10px;">
                    <table>
                        <thead><tr><th>Lvl</th><th>Move</th><th>Type</th><th>Pwr</th></tr></thead>
                        <tbody id="movesBody"></tbody>
                    </table>
                </div>
            </div>

        </div>

    </div>
</div>

</div>

<script>
    let allPokes = [], currentPoke = null, isShiny = false, activeVer = 'scarlet', activeGame = 'sv', moveMode = 'all';
    const typeColors = { grass: '#7AC74C', fire: '#EE8130', water: '#6390F0', bug: '#A6B91A', normal: '#A8A77A', poison: '#A33EA1', electric: '#F7D02C', ground: '#E2BF65', fairy: '#D685AD', fighting: '#C22E28', psychic: '#F95587', rock: '#B6A136', ghost: '#735797', ice: '#96D9D6', dragon: '#6F35FC', dark: '#705746', steel: '#B7B7CE', flying: '#A98FF3' };
    const cap = s => {
    // Lista de excepciones
    const exceptions = ['jangmo-o', 'hakamo-o', 'kommo-o', 'porygon-z', 'wo-chien', 'chien-pao', 'ting-lu', 'chi-yu'];
    if (exceptions.includes(s.toLowerCase())) {
        // Solo capitalizamos la primera letra de cada parte separada por guion
        return s.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('-');
    }
    // Para los dem√°s, reemplazamos guiones por espacios y capitalizamos cada palabra
    return s.replace(/-/g,' ').replace(/\b\w/g, l => l.toUpperCase());
};
    const dexButtons = document.querySelectorAll('.dex-btn');
    const dexTextDiv = document.getElementById('dexText');
    let currentPokemon = null; 
let favorites = JSON.parse(localStorage.getItem('pokeFavs')) || [];
    
function miniSearch() {
    const input = document.getElementById('miniSearchInput');
    const query = input.value.trim().toLowerCase();
    
    if (query) {
        // This assumes your main function is named loadPokemon
        loadPokemon(query);
        // Clear the input after searching
        input.value = "";
    }
}

function applyDynamicTheme(types) {
    let primaryColor = "#3b82f6"; // Default blue
    let bg = "#ffffff";

    if (types.length === 1) {
        primaryColor = typeColors[types[0].type.name] || "#3b82f6";
        bg = primaryColor;
    } else if (types.length >= 2) {
        primaryColor = typeColors[types[0].type.name] || "#3b82f6";
        const color2 = typeColors[types[1].type.name] || "#ffffff";
        bg = `linear-gradient(135deg, ${primaryColor}, ${color2})`;
    }

    // THIS IS THE KEY FOR YOUR BUTTONS:
    // It tells the CSS what "var(--accent)" should be
    document.documentElement.style.setProperty('--accent', primaryColor);
    
    // Apply the background to the body
    document.body.style.background = bg;
    document.body.style.backgroundAttachment = "fixed";
}

function getStatColor(v) {
    if(v < 50) return '#ff4d4d';
    if(v < 70) return '#ff944d';
    if(v < 90) return '#ffdb4d';
    if(v < 130) return '#52be80';
    if(v < 150) return '#5dade2';
    return '#af7ac5';
}

    window.onload = async () => {
        const data = await (await fetch('https://pokeapi.co/api/v2/pokemon-species?limit=1025')).json();
        allPokes = data.results.map((p, i) => ({ name: p.name, id: i + 1 }));
        setupSearch('pokeIn', 'pokeSuggs', allPokes, loadPokemon);
        setupSearch('miniSearchInput', 'pokeSuggsMini', allPokes, loadPokemon);
    };

    function goBack() {
        document.getElementById('display-card').style.display = 'none';
        document.getElementById('search-section').style.display = 'flex';
        document.body.classList.add('menu-active');
        document.body.className = '';
        window.scrollTo(0,0);
    }

    // --- REPAIRED LOAD FUNCTION ---
   async function loadPokemon(name) {
    try {
        let pokeData, speciesData;
        
        try {
            pokeData = await (await fetch(`https://pokeapi.co/api/v2/pokemon/${name.toLowerCase()}`)).json();
            speciesData = await (await fetch(pokeData.species.url)).json();
        } catch (e) {
            speciesData = await (await fetch(`https://pokeapi.co/api/v2/pokemon-species/${name.toLowerCase()}`)).json();
            const defaultUrl = speciesData.varieties.find(v => v.is_default).pokemon.url;
            pokeData = await (await fetch(defaultUrl)).json();
        }

        const evoData = await (await fetch(speciesData.evolution_chain.url)).json();

        // Save to global object
        currentPoke = { species: speciesData, poke: pokeData, evo: evoData };
        
        document.getElementById('search-section').style.display = 'none';
        document.getElementById('display-card').style.display = 'block';
        document.body.classList.remove('menu-active');
        
        await render(); 
        loadRandomDexEntry(speciesData.id);

        // --- ADDED FOR FAVORITES ---
        updateFavUI(); // Refreshes heart icon state for the new Pokemon
        // ---------------------------

        window.scrollTo(0, 0);
    } catch (err) {
        console.error(err);
        alert("Pok√©mon or Form not found!");
    }
}

    async function render() {
    if (!currentPoke) return;
    const { species, poke, evo } = currentPoke;

    // A. Apply the theme colors first
    applyDynamicTheme(poke.types);

    // B. Basic Info
    document.getElementById('pokeName').innerText = cap(poke.name);
    document.getElementById('dexNumber').innerText = `#${species.id.toString().padStart(4, '0')}`;
    document.getElementById('pCat').innerText = species.genera.find(g => g.language.name === 'en')?.genus || "";

    // C. Image Logic
    const imgUrl = isShiny ? 
        (poke.sprites.other.home.front_shiny || poke.sprites.front_shiny) : 
        (poke.sprites.other.home.front_default || poke.sprites.front_default);
    document.getElementById('pokeImg').src = imgUrl;

    // D. Types
    document.getElementById('pokeTypes').innerHTML = poke.types.map(t => 
        `<span class="type-badge" style="background:${typeColors[t.type.name]}">${t.type.name}</span>`
    ).join('');

    // E. Stats & BST (The part that was likely broken)
    let statsHtml = "";
    let baseStatTotal = 0;

    poke.stats.forEach(s => {
        baseStatTotal += s.base_stat;
        const shortName = s.stat.name.replace('special-', 'S').substring(0,3).toUpperCase();

        statsHtml += `
    <div class="stat-row">
        <div style="width:35px; font-size:11px; font-weight:bold;">${shortName}</div>
        <div style="width:35px; text-align:right; font-weight:bold;">${s.base_stat}</div>
        <div class="stat-bar-bg">
<div class="stat-bar-fill" style="width:${(s.base_stat/255)*100}%; background:${getStatColor(s.base_stat)}"></div>        </div>
    </div>`;
    });

    // Add the Total line
    statsHtml += `
        <div style="margin-top:10px; padding-top:8px; border-top:1px solid #ddd; display:flex; justify-content:space-between; font-weight:900;">
            <span>BST</span>
            <span>${baseStatTotal}</span>
        </div>`;
    
    document.getElementById('stats-area').innerHTML = statsHtml;

       // Render Abilities
let absHtml = "";

// 1. Filter out duplicates based on the ability name
const uniqueAbilities = poke.abilities.filter((ability, index, self) =>
    index === self.findIndex((a) => a.ability.name === ability.ability.name)
);

for(let a of uniqueAbilities) {
    // 2. Only show (HA) badge if there's more than one UNIQUE ability
    const showHA = a.is_hidden && uniqueAbilities.length > 1;
    
    const d = await (await fetch(a.ability.url)).json();
    const entry = d.effect_entries.find(e => e.language.name === 'en');
    
    absHtml += `
        <div style="margin-bottom:12px; font-size: 13px; line-height: 1.4;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 2px;">
                <strong style="color: #1e293b; letter-spacing: 0.5px;">
                    ${cap(a.ability.name).toUpperCase()}
                </strong>
                ${showHA ? `<span style="font-size: 9px; font-weight: 800; color: var(--silver-dark); background: var(--silver-light); padding: 2px 6px; border-radius: 4px; border: 1px solid var(--silver-mid);">HA</span>` : ''}
            </div>
            <div style="color: #64748b; font-size: 12px;">
                ${entry ? entry.short_effect : "No info available."}
            </div>
        </div>`;
}
document.getElementById('abilitiesArea').innerHTML = absHtml;

const types = poke.types.map(t => t.type.name);
const damageMultipliers = {};
const allTypes = ['normal', 'fire', 'water', 'electric', 'grass', 'ice', 'fighting', 'poison', 'ground', 'flying', 'psychic', 'bug', 'rock', 'ghost', 'dragon', 'dark', 'steel', 'fairy'];
allTypes.forEach(type => damageMultipliers[type] = 1);

for (const typeName of types) {
    const typeReq = await fetch(`https://pokeapi.co/api/v2/type/${typeName}`);
    const typeData = await typeReq.json();
    typeData.damage_relations.double_damage_from.forEach(t => damageMultipliers[t.name] *= 2);
    typeData.damage_relations.half_damage_from.forEach(t => damageMultipliers[t.name] *= 0.5);
    typeData.damage_relations.no_damage_from.forEach(t => damageMultipliers[t.name] *= 0);
}

// Containers for our three categories
let weakHtml = "";
let resistHtml = "";
let immuneHtml = "";

// Sort keys so 4x comes before 2x, and 0.5x before 0.25x
const sortedEntries = Object.entries(damageMultipliers)
    .filter(([type, mult]) => mult !== 1)
    .sort((a, b) => b[1] - a[1]);

sortedEntries.forEach(([type, mult]) => {
    const badge = `
        <div style="display:flex; flex-direction:column; align-items:center; gap:2px;">
            <span class="type-badge" style="background:${typeColors[type]}; margin:0; font-size:9px; width:45px; text-align:center;">
                ${type}
            </span>
            <span style="font-size:9px; font-weight:900; color:${mult > 1 ? '#ef4444' : mult === 0 ? '#64748b' : '#10b981'};">
                ${mult}x
            </span>
        </div>`;
    
    if (mult > 1) {
        weakHtml += badge;
    } else if (mult > 0) {
        resistHtml += badge;
    } else {
        // Immunity (0x) logic
        immuneHtml += badge;
    }
});

// Helper to wrap each section
const renderSection = (id, title, content) => {
    const el = document.getElementById(id);
    if (content === "") {
        el.style.display = "none"; // Hide section if empty (e.g., no immunities)
        return;
    }
    el.style.display = "block";
    el.innerHTML = `
        <div style="margin: 8px 0; padding: 6px; background: rgba(255,255,255,0.3); border-radius: 8px; border: 1px solid #e2e8f0;">
            <div style="font-size: 8px; font-weight: 800; color: #94a3b8; margin-bottom: 4px; text-transform: uppercase; text-align:center;">${title}</div>
            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 6px;">${content}</div>
        </div>
    `;
};

renderSection('typeWeakness', 'Weaknesses', weakHtml);
renderSection('typeResistance', 'Resistances', resistHtml);
renderSection('typeImmunity', 'Immunities', immuneHtml);

// Inside render() after baseStatTotal is calculated:
const role = getPokemonRole(poke.stats, baseStatTotal);

const roleBadge = `
    <div style="
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        background: ${role.color};
        color: white;
        font-size: 10px;
        font-weight: 900;
        letter-spacing: 1px;
        margin-bottom: 5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    ">
        ${role.label}
    </div>
`;

document.getElementById('role-container').innerHTML = roleBadge;

        renderEvoChain(evo.chain);
        renderFormsList();
        renderMoves();
    }

    function renderFormsList() {
    const varieties = currentPoke.species.varieties;
    const list = document.getElementById('formsList');
    const formsArea = document.getElementById('formsArea');

    // --- STANDARD LOGIC (except Minior & Pikachu) ---
    if (currentPoke.species.name !== 'minior' && currentPoke.species.name !== 'pikachu') {
        if (varieties.length <= 1) {
            formsArea.style.display = 'none';
            return;
        }
        formsArea.style.display = 'block';
        list.innerHTML = varieties.map(v => {
            const isCurrent = v.pokemon.name === currentPoke.poke.name;
            const label = v.is_default 
                ? 'BASE' 
                : v.pokemon.name.replace(currentPoke.species.name + '-', '').toUpperCase();
            return `<button class="form-btn ${isCurrent ? 'active' : ''}" onclick="loadForm('${v.pokemon.name}')">${label}</button>`;
        }).join('');
        return;
    }

    // --- MINIOR LOGIC ---
    if (currentPoke.species.name === 'minior') {
        formsArea.style.display = 'block';
        const meteorForm = varieties.find(v => v.pokemon.name.includes('meteor'));
        const coreForm = varieties.find(v => !v.pokemon.name.includes('meteor'));

        const simplifiedVarieties = [
            { name: meteorForm.pokemon.name, label: 'METEOR FORM' },
            { name: coreForm.pokemon.name, label: 'CORE FORM' }
        ];

        list.innerHTML = simplifiedVarieties.map(v => {
            const isCurrent = currentPoke.poke.name.includes('meteor') 
                ? v.label === 'METEOR FORM' 
                : v.label === 'CORE FORM';
            return `<button class="form-btn ${isCurrent ? 'active' : ''}" onclick="loadForm('${v.name}')">${v.label}</button>`;
        }).join('');
        return;
    }

    // --- PIKACHU LOGIC ---
    if (currentPoke.species.name === 'pikachu') {
        formsArea.style.display = 'block';

        // Separar Cap forms y las normales, excluyendo Cosplay
        const capForms = varieties.filter(v => v.pokemon.name.includes('cap'));
        const normalForms = varieties.filter(v => 
            !v.pokemon.name.includes('cap') && !v.pokemon.name.includes('cosplay')
        );

        // Botones para formas normales
        let html = normalForms.map(v => {
            const isCurrent = v.pokemon.name === currentPoke.poke.name;
            const label = v.is_default 
                ? 'BASE' 
                : v.pokemon.name.replace('pikachu-', '').toUpperCase();
            return `<button class="form-btn ${isCurrent ? 'active' : ''}" onclick="loadForm('${v.pokemon.name}')">${label}</button>`;
        }).join('');

        // Bot√≥n √∫nico para todas las Cap forms, si hay alguna
        const filteredCapForms = capForms.filter(v => !v.pokemon.name.includes('cosplay'));
        if (filteredCapForms.length > 0) {
            const isCurrentCap = filteredCapForms.some(v => v.pokemon.name === currentPoke.poke.name);
            html += `<button class="form-btn ${isCurrentCap ? 'active' : ''}" onclick="loadCapForms()">CAP</button>`;
        }

        list.innerHTML = html;
        return;
    }
}

// Carga una forma normal
async function loadForm(variantName) {
    const pokeData = await (await fetch(`https://pokeapi.co/api/v2/pokemon/${variantName}`)).json();
    currentPoke.poke = pokeData;
    render(); // Refresh stats, images, etc.
}

// Carga la primera forma Cap (puedes expandir a submen√∫ si quieres elegir entre varias)
async function loadCapForms() {
    const capForm = currentPoke.species.varieties.find(v => v.pokemon.name.includes('cap') && !v.pokemon.name.includes('cosplay'));
    if (!capForm) return;
    await loadForm(capForm.pokemon.name);
    // Aqu√≠ podr√≠as abrir un modal o submen√∫ para elegir cu√°l de las Cap forms
}

    // --- SEARCH LOGIC ---
    function setupSearch(id, sugId, list, cb) {
        const inp = document.getElementById(id), sug = document.getElementById(sugId), goBtn = document.getElementById('goBtn');
        inp.oninput = () => {
            const val = inp.value.toLowerCase();
            sug.innerHTML = "";
            if(!val) { sug.style.display = "none"; return; }
            const matches = list.filter(p => p.name.includes(val) || p.id.toString() === val).slice(0, 10);
            sug.style.display = matches.length ? "block" : "none";
            matches.forEach(m => {
                const d = document.createElement('div');
                d.className = "list-item";
                d.innerHTML = `<span style="color:#94a3b8; font-weight:bold; margin-right:10px;">#${m.id}</span>${cap(m.name)}`;
                d.onclick = () => { cb(m.name); sug.style.display="none"; inp.value=""; };
                sug.appendChild(d);
            });
        };
        goBtn.onclick = () => { if(inp.value) cb(inp.value); };
    }

    function toggleShiny() {
        isShiny = !isShiny;
        document.getElementById('shinySparkle').classList.toggle('active');
        render();
    }

    // --- Placeholder for other functions to keep code running ---
    function setGame(g, btn) {
    activeGame = g;
    document.querySelectorAll('.game-btn').forEach(b => {
        b.classList.remove('active');
        if (b.id !== btn.id) b.style.opacity = '0.5'; // grisear el no seleccionado
        else b.style.opacity = '1';
    });
    btn.classList.add('active');
    renderMoves();
}
    function setMoveMode(mode, btn) {
        moveMode = mode;
        // Update active class on buttons
        document.querySelectorAll('.v-toggle').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderMoves();
    }
    async function renderMoves() {
    const body = document.getElementById('movesBody');
    if (!currentPoke || !currentPoke.poke) return;

    body.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px;'>Loading moves...</td></tr>";

    const poke = currentPoke.poke;

    // Determinar el grupo de versiones seg√∫n el juego seleccionado
    let vGroup = '';
    if (activeGame === 'sv') vGroup = 'scarlet-violet';
    else if (activeGame === 'la') vGroup = 'legends-arceus';
    else if (activeGame === 'ss') vGroup = 'sword-shield';
    else if (activeGame === 'bdsp') vGroup = 'brilliant-diamond-shining-pearl';
    else if (activeGame === 'lgpe') vGroup = 'lets-go-pikachu-eevee';
    else if (activeGame === 'usum') vGroup = 'ultra-sun-ultra-moon';
    else if (activeGame === 'sm') vGroup = 'sun-moon';
    else if (activeGame === 'oras') vGroup = 'omega-ruby-alpha-sapphire';
    else if (activeGame === 'xy') vGroup = 'x-y';
    else vGroup = 'scarlet-violet';

    // Filtrar movimientos seg√∫n version_group y moveMode
    let movesList = poke.moves.filter(m => {
        return m.version_group_details.some(v => {
            const matchVersion = v.version_group.name === vGroup;
            const matchMethod = (moveMode === 'all' || v.move_learn_method.name === moveMode);
            return matchVersion && matchMethod;
        });
    });

    // Ordenar por nivel si aplica
    if (moveMode === 'level-up' || moveMode === 'all') {
        movesList.sort((a, b) => {
            const aDet = a.version_group_details.find(v => v.version_group.name === vGroup && v.move_learn_method.name === 'level-up');
            const bDet = b.version_group_details.find(v => v.version_group.name === vGroup && v.move_learn_method.name === 'level-up');
            return (aDet?.level_learned_at || 0) - (bDet?.level_learned_at || 0);
        });
    }

    if (movesList.length === 0) {
        body.innerHTML = `<tr><td colspan='4' style='text-align:center; padding:20px;'>No moves found for this game.</td></tr>`;
        return;
    }

    // Obtener datos de cada movimiento y renderizar
    let html = "";
    try {
        const movePromises = movesList.slice(0, 80).map(async (m) => {
            const res = await fetch(m.move.url);
            const data = await res.json();

            // Detalle del movimiento seg√∫n el modo
            let detail;
            if (moveMode === 'all') {
                detail = m.version_group_details.find(v => v.version_group.name === vGroup && v.move_learn_method.name === 'level-up') 
                         || m.version_group_details.find(v => v.version_group.name === vGroup);
            } else {
                detail = m.version_group_details.find(v => v.version_group.name === vGroup && v.move_learn_method.name === moveMode);
            }

            let displayLvl = '‚Äî';
            if (detail && detail.move_learn_method.name === 'level-up') displayLvl = detail.level_learned_at;
            if (moveMode === 'machine' || moveMode === 'egg'|| moveMode === 'tutor') displayLvl = '‚Äî';

            return {
                lvl: displayLvl,
                name: m.move.name,
                type: data.type.name,
                power: data.power || '‚Äî',
                category: data.damage_class.name
            };
        });

        const moveDataResults = await Promise.all(movePromises);

        moveDataResults.forEach(m => {
            const catIcon = `<span class="cat-icon cat-${m.category}"></span>`;
            html += `
                <tr>
                    <td style="font-weight:bold; color:#64748b; text-align:center; width:40px;">${m.lvl}</td>
                    <td style="font-weight:bold; font-variant: small-caps; font-size: 14px;">
                        ${catIcon}${m.name.replace(/-/g, ' ')}
                    </td>
                    <td style="width:80px;">
                        <span class="type-badge" style="background:${typeColors[m.type]}; margin:0; font-size:9px; display:block; text-align:center;">
                            ${m.type}
                        </span>
                    </td>
                    <td style="font-weight:bold; text-align:center; width:40px;">${m.power}</td>
                </tr>`;
        });

        body.innerHTML = html;
    } catch (err) {
        console.error(err);
        body.innerHTML = "<tr><td colspan='4'>Error loading moves.</td></tr>";
    }
    }

    // Generar las filas de la tabla con los movimientos
    const movesBody = document.getElementById('movesBody');
    movesBody.innerHTML = ''; // Limpiar cualquier contenido anterior

    movesList.forEach(m => {
        const moveDetails = m.move;
        const moveType = moveDetails.type.name; // Tipo del movimiento
        const movePower = moveDetails.power || '-'; // Poder del movimiento (si existe)

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${m.version_group_details[0].level_learned_at || '-'}</td>
            <td>${cap(moveDetails.name)}</td>
            <td><span class="type-badge" style="background:${typeColors[moveType]}">${moveType}</span></td>
            <td>${movePower}</td>
        `;
        movesBody.appendChild(row);
    });
    async function renderEvoChain(chain) {
    const container = document.getElementById('evoChain');
    container.innerHTML = ""; 
    // Maintains centering and horizontal scroll if the chain is long (e.g., Eevee)
    container.style.cssText = `
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: center;
        overflow-x: auto;
        padding: 10px 0;
        gap: 0;
        width: 100%;
    `;

    await renderBranch(chain, container);

    async function renderBranch(stage, targetContainer) {
        const column = document.createElement('div');
        column.style.cssText = "display: flex; flex-direction: column; align-items: center; gap: 8px; flex-shrink: 0;";
        
        // 1. Fetch species data and filter for regional variants
        const speciesRes = await fetch(stage.species.url);
        const speciesData = await speciesRes.json();
        const forms = speciesData.varieties.filter(v => 
            v.pokemon.name.includes('-alola') || v.pokemon.name.includes('-galar') || 
            v.pokemon.name.includes('-hisui') || v.pokemon.name.includes('-paldea') || v.is_default
        );

        const formsBox = document.createElement('div');
        formsBox.style.cssText = "display: flex; flex-direction: column; gap: 4px; align-items: center; min-width: 60px;";
        
        forms.forEach((form, idx) => {
            // Visual separator line for regional forms
            if (!form.is_default && idx > 0) {
                const line = document.createElement('div');
                line.style.cssText = "width: 25px; height: 1px; background: #e2e8f0; margin: 2px 0;";
                formsBox.appendChild(line);
            }

            const isCurrent = form.pokemon.name === currentPoke.poke.name;
            const formId = form.pokemon.url.split('/').slice(-2, -1)[0];
            const name = form.is_default ? stage.species.name : form.pokemon.name.split('-')[1];

            const pokeDiv = document.createElement('div');
            pokeDiv.style.cssText = `
                cursor: pointer;
                text-align: center;
                padding: 4px;
                width: 100%;
                transition: transform 0.2s ease;
                ${isCurrent ? 'background:#f1f5f9; border-radius:12px; border:2px solid var(--accent);' : ''}
            `;
            pokeDiv.innerHTML = `
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${formId}.png" style="width:45px; height:45px; object-fit:contain;">
                <div style="font-weight:900; font-size:8px;">${name.toUpperCase()}</div>
            `;
            pokeDiv.onclick = () => loadPokemon(form.pokemon.name);
            formsBox.appendChild(pokeDiv);
        });

        column.appendChild(formsBox);
        targetContainer.appendChild(column);

        // 2. Handle branching evolutions
        if (stage.evolves_to.length > 0) {
            const branchWrapper = document.createElement('div');
            // This wrapper ensures multiple evolutions (Eevee) stack vertically while staying centered
            branchWrapper.style.cssText = "display: flex; flex-direction: column; gap: 12px; justify-content: center;";
            targetContainer.appendChild(branchWrapper);
            
            for (const next of stage.evolves_to) {
                const pathContainer = document.createElement('div');
                pathContainer.style.cssText = "display: flex; align-items: center;";
                branchWrapper.appendChild(pathContainer);

                // Evolution Detail Logic
                const details = next.evolution_details[0];
                let methodText = "LEVEL UP"; 

                if (details) {
                    const parts = [];
                    
                    // Remap Locations to Stones
                    if (details.location) {
                        const loc = details.location.name.toLowerCase();
                        if (loc.includes('moss') || loc.includes('eterna-forest') || loc.includes('pinwheel-forest') || loc.includes('petalburg-woods')) parts.push("LEAF STONE");
                        else if (loc.includes('sinnoh') || loc.includes('frost') || loc.includes('lanakila') || loc.includes('twist-mountain')) parts.push("ICE STONE");
                        else if (loc.includes('magnetic') || loc.includes('coronet') || loc.includes('chargestone') || loc.includes('mauville') || loc.includes('kalos-route-13')) parts.push("THUNDER STONE");
                        else parts.push(`AT ${details.location.name.replace(/-/g, ' ').toUpperCase()}`);
                    }

                    if (details.known_move_type) parts.push(`KNOWS ${details.known_move_type.name.toUpperCase()} MOVE`);
                    if (details.min_happiness || details.min_affection) parts.push(`FRIENDSHIP${details.time_of_day ? ' (' + details.time_of_day.toUpperCase() + ')' : ''}`);
                    if (details.item) parts.push(details.item.name.replace(/-/g, ' ').toUpperCase());
                    if (details.min_level) parts.push(`LVL ${details.min_level}`);
                    if (details.trigger.name === 'trade') parts.push("TRADE");
                    if (details.held_item) parts.push(`HOLD ${details.held_item.name.replace(/-/g, ' ').toUpperCase()}`);
                    if (details.known_move) parts.push(`MOVE: ${details.known_move.name.toUpperCase()}`);
                    
                    methodText = [...new Set(parts)].join(' + ') || details.trigger.name.replace(/-/g, ' ').toUpperCase();
                }

                const connector = document.createElement('div');
                connector.style.cssText = "display: flex; flex-direction: column; align-items: center; justify-content: center; min-width: 60px; padding: 0 4px;";
                connector.innerHTML = `
                    <span style="font-size: 6px; font-weight: 900; color: #94a3b8; margin-bottom: -3px; text-align: center; line-height: 1;">
                        ${methodText}
                    </span>
                    <span style="color: #cbd5e1; font-size: 18px;">‚Üí</span>
                `;
                
                pathContainer.appendChild(connector);
                await renderBranch(next, pathContainer);
            }
        }
    }
}

async function loadRandomPokemon() {
    try {
        // 1. Fetch the total count of all POKEMON (including forms)
        // This endpoint includes forms like 'giratina-origin', 'zacian-crowned', etc.
        const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=1');
        const data = await response.json();
        const totalCount = data.count; // Usually around 1300+

        // 2. Pick a random index from the entire list
        const randomOffset = Math.floor(Math.random() * totalCount);

        // 3. Fetch just that one random result
        const randomRes = await fetch(`https://pokeapi.co/api/v2/pokemon?offset=${randomOffset}&limit=1`);
        const randomData = await randomRes.json();
        
        const randomName = randomData.results[0].name;

        // 4. Load it!
        console.log("Loading random form:", randomName);
        loadPokemon(randomName);

    } catch (err) {
        console.error("Error fetching random form:", err);
        // Fallback to a base ID if the API call fails
        const randomId = Math.floor(Math.random() * 1025) + 1;
        loadPokemon(randomId.toString());
    }
}

async function loadRandomDexEntry(pokemonId) {
    const box = document.getElementById("dexEntryText");
    
    // Safety check in case the element isn't in the DOM yet
    if (!box) return;

    box.innerHTML = `<span style="color: #cbd5e1;">Loading entry...</span>`;

    try {
        const res = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${pokemonId}`);
        const data = await res.json();

        // Filter for English entries only
        const entries = data.flavor_text_entries.filter(
            e => e.language.name === "en"
        );

        if (entries.length === 0) {
            box.textContent = "No entry available for this Pok√©mon.";
            return;
        }

        // Pick a random entry
        const randomEntry = entries[Math.floor(Math.random() * entries.length)];

        // Clean up text: replace special characters (\f, \n) with spaces
        box.textContent = randomEntry.flavor_text.replace(/\n|\f/g, " ");

    } catch (err) {
        console.error("Dex Entry Error:", err);
        box.textContent = "No entry available.";
    }
}
// Variable to keep favorites in sync
favorites = JSON.parse(localStorage.getItem('pokeFavs')) || [];

function toggleFavorite() {
    if (!currentPoke || !currentPoke.poke) return;

    const pokemon = currentPoke.poke;
    const index = favorites.findIndex(p => p.id === pokemon.id);

    if (index === -1) {
        // ADD to list
        favorites.push({
            id: pokemon.id,
            name: pokemon.name,
            sprite: pokemon.sprites.front_default 
        });
    } else {
        // REMOVE from list
        favorites.splice(index, 1);
    }

    // THE SAVE STEP: This puts the list into permanent browser memory
    localStorage.setItem('pokeFavs', JSON.stringify(favorites));
    
    // Refresh the visuals
    updateFavUI();
}

function updateFavUI() {
    const gallery = document.getElementById('favorites-gallery');
    const favBtn = document.getElementById('fav-btn');

    // 1. Always pull the latest save from memory
    favorites = JSON.parse(localStorage.getItem('pokeFavs')) || [];

    // 2. Update the Heart Emoji on the current page
    if (favBtn && currentPoke && currentPoke.poke) {
        const isFav = favorites.some(p => p.id === currentPoke.poke.id);
        favBtn.textContent = isFav ? '‚ù§Ô∏è' : 'ü§ç';
    }

    if (!gallery) return;

    // 3. Render the Team Gallery
    if (favorites.length === 0) {
        gallery.innerHTML = `<span style="color:#94a3b8; font-size: 11px;">No favorites yet.</span>`;
        return;
    }

    gallery.innerHTML = favorites.map(p => `
        <div onclick="loadPokemon('${p.name}')" 
             style="cursor:pointer; transition: 0.2s;" 
             onmouseover="this.style.transform='scale(1.2)'" 
             onmouseout="this.style.transform='scale(1)'"
             title="${p.name}">
            <img src="${p.sprite}" 
                 style="width:50px; height:50px; image-rendering:pixelated;" 
                 alt="${p.name}">
        </div>
    `).join('');
}

/**
 * Click a sprite to search it instantly
 */
function quickSearch(name) {
    // Calls your actual search function
    loadPokemon(name);
    
    // If you have a specific input to clear/update:
    const input = document.getElementById('pokeIn'); 
    if(input) input.value = name;
}
function getPokemonRole(stats, bst) {
    const hp = stats.find(s => s.stat.name === 'hp').base_stat;
    const atk = stats.find(s => s.stat.name === 'attack').base_stat;
    const def = stats.find(s => s.stat.name === 'defense').base_stat;
    const spa = stats.find(s => s.stat.name === 'special-attack').base_stat;
    const spd = stats.find(s => s.stat.name === 'special-defense').base_stat;
    const spe = stats.find(s => s.stat.name === 'speed').base_stat;

    // Helper para chequear si son "balanceados" en ataque
    const isMixed = Math.abs(atk - spa) <= Math.max(atk, spa) * 0.3;

    // Roles
    if (bst < 300) return { label: "LITTLE CUP", color: "#94a3b8" };
    
    if (atk >= 100 && spa >= 100 && spe > 80 && isMixed) 
        return { label: "MIXED ATTACKER", color: "#ef4444" };
    
    if (atk >= 100 && spa >= 100 && spe <= 80 && isMixed) 
        return { label: "SLOW MIXED ATTACKER", color: "#f97316" };
    
    if (spe >= 100 && (atk >= 100 || spa >= 100)) {
    if (atk > spa) {
        return { label: "PHYSICAL GLASS CANNON", color: "#2563eb" }; // azul
    } else if (spa > atk) {
        return { label: "SPECIAL GLASS CANNON", color: "#9333ea" }; // morado
    } else {
        return { label: "MIXED GLASS CANNON", color: "#3b638f" }; // si atk = spa
    }
}
    if ((def >= 100 || spd >= 100) && spe <= 50) 
        return { label: "SLOW & BULKY", color: "#16a34a" };

    // Nueva regla: si las defensas son mayores que los ataques, lo marcamos defensivo
    if (def > atk && spd > spa) return { label: "DEFENSIVE", color: "#0ea5e9" };

    // Si no es defensivo, seguimos con Physical/Special Attacker
    if (atk > spa) return { label: "PHYSICAL ATTACKER", color: "#dc2626" };
    if (spa > atk) return { label: "SPECIAL ATTACKER", color: "#8b5cf6" };
    
    return { label: "BALANCED", color: "#64748b" };

}
// Ensure the UI updates when the page first loads
document.addEventListener('DOMContentLoaded', () => {
    updateFavUI();
});
</script>
</body>
</html>

